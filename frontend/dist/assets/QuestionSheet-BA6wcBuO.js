import{_ as z,a as n,o as U,c as T,b as y,e,w as t,v,p as F,f as P,r as i,i as G,x as ee,j as R,y as K,t as j,E as B,d as Y,z as te,q as ae,s as le,F as H,h as oe,A as ne}from"./index-dg0POEbG.js";import{a as I}from"./index-D4ibRccp.js";import{s as se}from"./Search-CwHlSzEf.js";const ue={},J=d=>(F("data-v-7db45670"),d=d(),P(),d),re={class:"sheet-editor-header"},ce={class:"se-header-container"},ie=J(()=>y("a",{href:"#"},"question-sheet",-1)),de=J(()=>y("h1",null,"题单广场",-1));function _e(d,f){const s=n("el-breadcrumb-item"),l=n("el-breadcrumb");return U(),T("div",re,[y("div",ce,[e(l,{separator:"/",class:"breadcrumb"},{default:t(()=>[e(s,{to:{path:"/staging"}},{default:t(()=>[v("staging")]),_:1}),e(s,null,{default:t(()=>[ie]),_:1})]),_:1}),de])])}const pe=z(ue,[["render",_e],["__scopeId","data-v-7db45670"]]),me=d=>(F("data-v-e4f0390e"),d=d(),P(),d),ve={class:"search-icon-container"},fe=me(()=>y("span",{style:{"font-size":"18px"}},"搜索题单类型",-1)),ge={__name:"QSNav",props:{total:Number},emits:["updateSearchStatus","updateSearchQuery","updateSearchType","createQuestionSheet"],setup(d,{emit:f}){const s=i(""),l=i("all"),$=i(!1),Q=i(!1),p=f,C=()=>{if(s.value===""){B.error("搜索关键词不能为空");return}B.success(`搜索关键词: ${s.value}`),$.value=!0,p("updateSearchQuery",s),p("updateSearchStatus",$)},c=m=>{l.value=m,console.log(l.value),p("updateSearchType",l)},w=()=>{Q.value=!0,p("createQuestionSheet",Q)};return(m,u)=>{const D=n("el-icon"),E=n("el-input"),g=n("el-col"),r=n("el-button"),k=n("el-row"),V=n("el-button-group"),q=n("el-header"),L=n("el-container");return U(),G(L,{class:"qs-nav-container"},{default:t(()=>[e(q,{class:"header"},{default:t(()=>[e(k,{gutter:20},{default:t(()=>[e(g,{span:8},{default:t(()=>[e(E,{modelValue:s.value,"onUpdate:modelValue":u[0]||(u[0]=S=>s.value=S),placeholder:"查找题单",onKeyup:ee(C,["enter"])},{prepend:t(()=>[y("div",ve,[e(D,{size:"20px"},{default:t(()=>[e(R(se))]),_:1})])]),_:1},8,["modelValue"])]),_:1}),e(g,{span:10},{default:t(()=>[e(r,{type:"primary",onClick:C},{default:t(()=>[v("搜索")]),_:1})]),_:1}),e(g,{span:2},{default:t(()=>[e(r,{type:"success",onClick:w},{default:t(()=>[v("创建题单")]),_:1})]),_:1}),e(g,{span:2},{default:t(()=>[e(r,{type:"primary",onClick:u[1]||(u[1]=S=>R(K).push("/my-sheet"))},{default:t(()=>[v("我创建的题单")]),_:1})]),_:1})]),_:1}),e(k,{gutter:20,style:{"margin-top":"20px"}},{default:t(()=>[e(g,{span:3},{default:t(()=>[fe]),_:1}),e(g,{span:12},{default:t(()=>[e(V,null,{default:t(()=>[e(r,{type:l.value==="all"?"primary":"",onClick:u[2]||(u[2]=S=>c("all"))},{default:t(()=>[v(" 全部题单 ")]),_:1},8,["type"]),e(r,{type:l.value==="official"?"primary":"",onClick:u[3]||(u[3]=S=>c("official"))},{default:t(()=>[v(" 官方精选 ")]),_:1},8,["type"]),e(r,{type:l.value==="user"?"primary":"",onClick:u[4]||(u[4]=S=>c("user"))},{default:t(()=>[v(" 用户分享 ")]),_:1},8,["type"])]),_:1})]),_:1})]),_:1}),e(k,{gutter:20,style:{"margin-top":"20px"}},{default:t(()=>[e(g,{span:24},{default:t(()=>[y("span",null,"共计 "+j(d.total)+" 条结果",1)]),_:1})]),_:1})]),_:1})]),_:1})}}},he=z(ge,[["__scopeId","data-v-e4f0390e"]]),be={class:"table-container"},ye=["innerHTML"],Se=Y({__name:"QSList",props:{tableData:Array,total:Number},emits:["pageChange","deleteRow"],setup(d,{emit:f}){const s=f,l=i(1),$=i(20),Q=c=>{s("pageChange",c),l.value=c},p=c=>{K.push(`/sheet-detail/${c}`)},C=c=>{s("deleteRow",c)};return(c,w)=>{const m=n("el-table-column"),u=n("el-link"),D=n("el-button"),E=n("el-table"),g=n("el-pagination");return U(),T("div",be,[e(E,{data:d.tableData,style:{width:"100%"}},{default:t(()=>[e(m,{prop:"id",label:"编号"}),e(m,{prop:"create_time",label:"创建时间"}),e(m,{label:"题单名称"},{default:t(r=>[e(u,{onClick:te(k=>p(r.row.id),["prevent"]),type:"primary",underline:""},{default:t(()=>[v(j(r.row.title),1)]),_:2},1032,["onClick"])]),_:1}),e(m,{prop:"questionCnt",label:"题目数"}),e(m,{prop:"author",label:"题单作者"}),e(m,{label:"简介"},{default:t(r=>[y("div",{innerHTML:r.row.content},null,8,ye)]),_:1}),e(m,{label:"操作"},{default:t(r=>[e(D,{type:"danger",onClick:k=>C(r.row.id),size:"small"},{default:t(()=>[v("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(g,{onCurrentChange:Q,"current-page":l.value,"page-size":$.value,total:d.total,layout:"prev, pager, next"},null,8,["current-page","page-size","total"])])}}}),Ce=z(Se,[["__scopeId","data-v-6fb4052e"]]),we={class:"question-sheet-container"},ke={slot:"footer",class:"dialog-footer"},$e=Y({__name:"QuestionSheet",setup(d){const f=i([]),s=i(0),l=i({users:[],title:"",content:"",is_all:!1}),$=async a=>{try{const o=await I.getAllQuestionSheet({pageNumber:a});f.value=o.results,s.value=o.count,console.log("total:",s.value),f.value.forEach(b=>{b.create_time=r(b.create_time)})}catch(o){console.error("Error fetching question sheets:",o)}},Q=async(a,o,b)=>{try{const h=await I.searchQuestionSheet({pageNumber:a,keyword:o,type:b});f.value=h.results,s.value=h.count,console.log("search result:",f.value),f.value.forEach(x=>{x.create_time=r(x.create_time)})}catch(h){console.error("Error searching question sheets:",h)}},p=i(1),C=i(""),c=i(!1),w=i(0),m=a=>{u(a),p.value=a},u=a=>{c.value.value==!0?Q(a,C.value,w.value):($(a),console.log("total:",s.value))};ae(()=>{u(1),W()});const D=a=>{c.value=a,console.log("isSearching:",c.value,p.value),u(p.value)},E=a=>{C.value=a.value},g=a=>{console.log("selectedType:",a.value),a.value=="all"?w.value=0:a.value=="official"?w.value=1:a.value=="user"&&(w.value=2)};function r(a){const o=new Date(a),b=o.getFullYear(),h=String(o.getMonth()+1).padStart(2,"0"),x=String(o.getDate()).padStart(2,"0"),M=String(o.getHours()).padStart(2,"0"),A=String(o.getMinutes()).padStart(2,"0");return`${b}-${h}-${x} ${M}:${A}`}const k=async a=>{try{await I.deleteQuestionGroup({id:a}),u(p.value)}catch(o){console.error("Error deleting question sheet:",o)}},V=i(!1),q=i(),L=a=>{console.log("beginCreate:",a),V.value=a},S=()=>{V.value=!1},O=async()=>{try{console.log(l.value),await I.uploadQuestionGroup(l.value),u(p.value),S();const a=ne.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});setTimeout(()=>{a.close()},500)}catch(a){console.error("Error creating question sheet:",a)}},W=async()=>{try{const a=await I.getAllUsers();return q.value=a,console.log("allUsers:",q.value),a}catch(a){console.error("Error fetching all users:",a)}};return le(()=>l.value.is_all,a=>{a&&(l.value.users=[])}),(a,o)=>{const b=n("el-input"),h=n("el-form-item"),x=n("el-option"),M=n("el-select"),A=n("el-checkbox"),X=n("el-form"),N=n("el-button"),Z=n("el-dialog");return U(),T(H,null,[e(pe),y("div",we,[e(he,{onUpdateSearchStatus:D,onUpdateSearchQuery:E,onUpdateSearchType:g,onCreateQuestionSheet:L,total:s.value},null,8,["total"]),e(Ce,{tableData:f.value,onPageChange:m,total:s.value,onDeleteRow:k},null,8,["tableData","total"]),e(Z,{modelValue:V.value,"onUpdate:modelValue":o[4]||(o[4]=_=>V.value=_),width:"500",title:"创建题单",class:"custom-dialog"},{default:t(()=>[e(X,{model:l.value},{default:t(()=>[e(h,{label:"题单名称"},{default:t(()=>[e(b,{modelValue:l.value.title,"onUpdate:modelValue":o[0]||(o[0]=_=>l.value.title=_)},null,8,["modelValue"])]),_:1}),e(h,{label:"题单简介"},{default:t(()=>[e(b,{modelValue:l.value.content,"onUpdate:modelValue":o[1]||(o[1]=_=>l.value.content=_)},null,8,["modelValue"])]),_:1}),e(h,{label:"可见用户"},{default:t(()=>[e(M,{modelValue:l.value.users,"onUpdate:modelValue":o[2]||(o[2]=_=>l.value.users=_),multiple:"",placeholder:"请选择",disabled:l.value.is_all},{default:t(()=>[(U(!0),T(H,null,oe(q.value,_=>(U(),G(x,{key:_.id,label:_.username,value:_.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),e(A,{modelValue:l.value.is_all,"onUpdate:modelValue":o[3]||(o[3]=_=>l.value.is_all=_)},{default:t(()=>[v("所有用户")]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),y("span",ke,[e(N,{onClick:S},{default:t(()=>[v("取消")]),_:1}),e(N,{type:"primary",onClick:O},{default:t(()=>[v("提交")]),_:1})])]),_:1},8,["modelValue"])])],64)}}}),Ue=z($e,[["__scopeId","data-v-9e57480a"]]);export{Ue as default};
